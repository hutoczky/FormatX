(() => { const root = document.documentElement; const btns = Array.from(document.querySelectorAll('.switcher .theme')); const link = document.getElementById('theme-css'); const KEY = 'scifi-ui.theme'; const saved = localStorage.getItem(KEY); if (saved) { apply(saved, false); } btns.forEach(b => { b.addEventListener('click', () => apply(b.dataset.theme, true)); b.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); apply(b.dataset.theme, true); } }); }); function apply(theme, persist) { if (!theme) return; root.setAttribute('data-theme', theme); if (link) { link.href = `styles/${theme}.css`; } btns.forEach(b => { const on = b.dataset.theme === theme; b.setAttribute('aria-pressed', on ? 'true' : 'false'); b.setAttribute('aria-selected', on ? 'true' : 'false'); }); if (persist) localStorage.setItem(KEY, theme); document.dispatchEvent(new CustomEvent('themechange', { detail: { theme } })); } })();