<Window
    x:Class="FormatX.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="using:Microsoft.UI.Xaml.Controls">
  <Grid Background="{StaticResource BackgroundBrush}">
    <Grid.Resources>
      <ThemeShadow x:Key="AppCardShadow"/>
      <ThemeShadow x:Key="AppFooterShadow"/>
    </Grid.Resources>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="Auto" />
      <ColumnDefinition Width="*" />
      <ColumnDefinition Width="Auto" />
    </Grid.ColumnDefinitions>

    <!-- Integrated Title Bar / Header -->
    <Border x:Name="AppTitleBar" Grid.Row="0" Grid.ColumnSpan="3" Background="{StaticResource PrimaryDarkBrush}" Padding="12" Height="48"
            PointerPressed="AppTitleBar_PointerPressed" DoubleTapped="AppTitleBar_DoubleTapped">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="8">
          <TextBlock Text="FormatX Pro" Foreground="{StaticResource WhiteTextBrush}" FontWeight="SemiBold" FontSize="14"/>
          <TextBlock Text="•" Foreground="{StaticResource MutedTextBrush}" VerticalAlignment="Center"/>
          <TextBlock x:Name="HeaderSectionLabel" Text="Idle" Foreground="{StaticResource MutedTextBrush}" VerticalAlignment="Center"/>
        </StackPanel>

        <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Spacing="6">
          <Button x:Name="BtnRefresh" Content="⟳" ToolTipService.ToolTip="Refresh" Click="Refresh_Click" Style="{StaticResource AccentButtonStyle}" AutomationProperties.Name="Refresh"/>
          <Button x:Name="BtnMin" Content="▁" ToolTipService.ToolTip="Minimize" Click="BtnMin_Click" Style="{StaticResource WindowControlButtonStyle}" AutomationProperties.Name="Minimize"/>
          <Button x:Name="BtnMax" Content="▢" ToolTipService.ToolTip="Maximize/Restore" Click="BtnMax_Click" Style="{StaticResource WindowControlButtonStyle}" AutomationProperties.Name="MaximizeRestore"/>
          <Button x:Name="BtnClose" Content="✕" ToolTipService.ToolTip="Close" Click="BtnClose_Click" Style="{StaticResource WindowControlButtonStyle}" AutomationProperties.Name="Close"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- Left sidebar -->
    <Border Grid.Row="1" Grid.Column="0" Margin="12" Padding="8" Style="{StaticResource CardPanelStyle}" MinWidth="56" MaxWidth="260">
      <StackPanel>
        <TextBlock Text="Operations" Style="{StaticResource SidebarHeaderStyle}"/>
        <Border Padding="6"><Button x:Name="SidebarIso" Content="ISO → USB" Tag="0" Click="SidebarNav_Click" Style="{StaticResource SidebarButtonStyle}" AutomationProperties.Name="ISO to USB" /></Border>
        <Border Padding="6"><Button x:Name="SidebarFormat" Content="Format" Tag="1" Click="SidebarNav_Click" Style="{StaticResource SidebarButtonStyle}" AutomationProperties.Name="Format" /></Border>
        <Border Padding="6"><Button x:Name="SidebarPartitions" Content="Partitions" Tag="2" Click="SidebarNav_Click" Style="{StaticResource SidebarButtonStyle}" AutomationProperties.Name="Partitions" /></Border>
        <Border Padding="6"><Button x:Name="SidebarSecure" Content="Secure Erase" Tag="3" Click="SidebarNav_Click" Style="{StaticResource SidebarButtonStyle}" AutomationProperties.Name="Secure Erase" /></Border>
        <TextBlock Text="System" Style="{StaticResource SidebarHeaderStyle}"/>
        <Border Padding="6"><Button x:Name="SidebarHealth" Content="Disk Health" Tag="4" Click="SidebarNav_Click" Style="{StaticResource SidebarButtonStyle}" AutomationProperties.Name="Disk Health" /></Border>
        <Border Padding="6"><Button x:Name="SidebarSettings" Content="Settings" Tag="5" Click="SidebarNav_Click" Style="{StaticResource SidebarButtonStyle}" AutomationProperties.Name="Settings" /></Border>
      </StackPanel>
    </Border>

    <!-- Main content -->
    <Border Grid.Row="1" Grid.Column="1" CornerRadius="12" Margin="12" Style="{StaticResource CardPanelStyle}" BorderThickness="1">
      <ui:TabView x:Name="MainTabView" Grid.Row="1" IsAddTabButtonVisible="False" Margin="8">
      <!-- ISO -> USB -->
      <ui:TabViewItem x:Name="TabIsoUsb" IsClosable="False" Header="ISO → USB">
        <Grid Padding="16" ColumnSpacing="16" RowSpacing="12">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="380"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBox x:Name="IsoPath" Width="300" PlaceholderText="Select ISO" Style="{StaticResource RoundedTextBoxStyle}"/>
            <!-- Reuse background picker to allow quick background change from main UI -->
            <Button x:Name="BtnBrowseIso" Content="Browse..." Click="PickBackground_Click" Style="{StaticResource AccentButtonStyle}" ToolTipService.ToolTip="Change background" AutomationProperties.Name="ChangeBackground"/>
          </StackPanel>

          <ComboBox x:Name="TargetDrives" Grid.Row="1" Width="220" Header="Target drive (removable)" Style="{StaticResource RoundedComboBoxStyle}"/>
          <Button Grid.Row="2" x:Name="BtnIsoWrite" Content="Write ISO" Click="WriteIso_Click" Width="120" Style="{StaticResource AccentButtonStyle}"/>
          <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Spacing="8" HorizontalAlignment="Left">
            <ComboBox x:Name="IsoWriteSchemeCombo" Width="120" Header="Séma">
              <ComboBoxItem Content="GPT" IsSelected="True"/>
              <ComboBoxItem Content="MBR"/>
            </ComboBox>
            <ToggleButton x:Name="IsoVerifyToggle" Content="Verify" IsChecked="True"/>
          </StackPanel>


          <TextBox x:Name="LogBox" Grid.Row="3" Grid.ColumnSpan="2" AcceptsReturn="True" TextWrapping="Wrap" ScrollViewer.VerticalScrollBarVisibility="Auto" Style="{StaticResource RoundedTextBoxStyle}"/>
        </Grid>
      </ui:TabViewItem>

      <!-- Format -->
      <ui:TabViewItem x:Name="TabFormat" IsClosable="False" Header="Format">
        <Grid Padding="16" ColumnSpacing="16" RowSpacing="12">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300"/>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>

          <ComboBox x:Name="FormatDrive" Grid.Column="0" Header="Meghajtó" Width="260" Style="{StaticResource RoundedComboBoxStyle}"/>
          <ComboBox x:Name="FsCombo" Grid.Column="1" Header="Fájlrendszer" Width="160" SelectionChanged="FsCombo_SelectionChanged">            <ComboBoxItem Content="NTFS"/>
            <ComboBoxItem Content="FAT32"/>
            <ComboBoxItem Content="exFAT"/>
            <ComboBoxItem x:Name="FsItemReFS" Content="ReFS"/>
            <ComboBoxItem x:Name="FsItemExt4" Content="ext4 (Linux)"/>
          </ComboBox>
          <TextBox x:Name="LabelBox" Grid.Row="1" Grid.Column="0" Header="Címke" Width="260" MaxLength="32" TextChanging="LabelBox_TextChanging" Style="{StaticResource RoundedTextBoxStyle}"/>
          <CheckBox x:Name="QuickBox" Grid.Row="1" Grid.Column="1" Content="Gyors formázás" IsChecked="True" VerticalAlignment="Center"/>
          <Button Grid.Row="2" Grid.Column="0" x:Name="BtnFormat" Content="Formázás" Click="Format_Click" Width="120" Style="{StaticResource AccentButtonStyle}"/>
        </Grid>
      </ui:TabViewItem>

      <!-- Partitions -->
      <ui:TabViewItem x:Name="TabPartitions" IsClosable="False" Header="Partitions">
        <Grid Padding="16" ColumnSpacing="16" RowSpacing="12">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="260"/>
            <ColumnDefinition Width="220"/>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="*"/>
          </Grid.ColumnDefinitions>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
          </Grid.RowDefinitions>

          <TextBox x:Name="DiskNumberBox" Header="Lemez sorszám (opcionális)" Style="{StaticResource RoundedTextBoxStyle}"/>
          <ComboBox x:Name="PartitionDrive" Grid.Column="1" Header="Cél meghajtó"/>
          <ComboBox x:Name="PartFsCombo" Grid.Column="2" Header="Fájlrendszer" SelectedIndex="0" SelectionChanged="PartFsCombo_SelectionChanged">            <ComboBoxItem Content="NTFS"/>
            <ComboBoxItem Content="FAT32"/>
            <ComboBoxItem Content="exFAT"/>
            <ComboBoxItem x:Name="PartFsItemReFS" Content="ReFS"/>
            <ComboBoxItem x:Name="PartFsItemExt4" Content="ext4 (Linux)"/>
          </ComboBox>
          <ComboBox x:Name="IsoSchemeCombo" Grid.Column="3" Header="Séma" SelectedIndex="0">
            <ComboBoxItem Content="GPT"/>
            <ComboBoxItem Content="MBR"/>
          </ComboBox>

          <TextBox x:Name="PartLabelBox" Grid.Row="1" Grid.Column="0" Header="Címke" MaxLength="32" TextChanging="PartLabelBox_TextChanging" Style="{StaticResource RoundedTextBoxStyle}"/>
          <CheckBox x:Name="PartQuickBox" Grid.Row="1" Grid.Column="1" Content="Gyors formázás" IsChecked="True" VerticalAlignment="Center"/>
          <Button Grid.Row="2" Grid.Column="0" x:Name="BtnPartition" Content="Particionál" Click="Partition_Click" Width="140"/>

          <StackPanel Grid.Row="3" Grid.ColumnSpan="4" Orientation="Horizontal" Spacing="12">
            <ProgressBar x:Name="PartProgress" Width="320" Style="{StaticResource ThinProgressBarStyle}" IsIndeterminate="False" Visibility="Collapsed"/>
            <TextBlock x:Name="PartProgressText" VerticalAlignment="Center" Visibility="Collapsed"/>
          </StackPanel>
        </Grid>
      </ui:TabViewItem>

      <!-- Settings -->
      
      <!-- Secure Erase -->
      <ui:TabViewItem x:Name="TabSecureErase" IsClosable="False" Header="Biztonságos törlés">
<StackPanel Padding="16" Spacing="8">
          <TextBlock Text="Target disk"/>
          <ComboBox x:Name="SecureErase_DriveCombo" Width="420" DisplayMemberPath="Display" SelectedValuePath="DevicePath" SelectionChanged="SecureErase_DriveCombo_SelectionChanged" Style="{StaticResource RoundedComboBoxStyle}"/>
          <CheckBox x:Name="EraseFullFormat" Content="Full format (slower)" IsChecked="True"/>
          <Button x:Name="BtnSecureErase" Content="Start erase" Width="160" Click="SecureErase_Click" Style="{StaticResource AccentButtonStyle}"/>
          <TextBlock x:Name="EraseResult" TextWrapping="Wrap"/>
        </StackPanel>
      </ui:TabViewItem>

      <!-- Disk Health -->
      <ui:TabViewItem x:Name="TabHealth" IsClosable="False" Header="Lemez egészség">
<StackPanel Padding="16" Spacing="8">
          <ComboBox x:Name="Health_DriveCombo" Width="420" DisplayMemberPath="Display" SelectedValuePath="DevicePath" SelectionChanged="Health_DriveCombo_SelectionChanged" Style="{StaticResource RoundedComboBoxStyle}"/>
          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBox x:Name="ScanBytes" Width="220" PlaceholderText="Bytes to scan (e.g. 1073741824)" Style="{StaticResource RoundedTextBoxStyle}"/>
            <Button Content="Surface scan" Click="SurfaceScan_Click" Style="{StaticResource AccentButtonStyle}"/>
          </StackPanel>
          <Button Content="SMART quick query" Width="220" Click="SmartQuick_Click" Style="{StaticResource AccentButtonStyle}"/>
          <TextBlock x:Name="HealthResult" TextWrapping="Wrap"/>
        </StackPanel>
      </ui:TabViewItem>

      <ui:TabViewItem x:Name="TabSettings" IsClosable="False" Header="Settings">
        <Border Style="{StaticResource CardPanelStyle}" Padding="12">
        <StackPanel Padding="8" Spacing="8">
          <TextBlock x:Name="TxtLanguage" Text="Nyelv" FontWeight="SemiBold"/>
          <ComboBox x:Name="LangCombo" SelectedIndex="0" Style="{StaticResource RoundedComboBoxStyle}">
            <ComboBoxItem Content="Magyar" />
            <ComboBoxItem Content="English" />
          </ComboBox>

          <TextBlock x:Name="TxtTheme" Text="Téma" Margin="0,12,0,0" FontWeight="SemiBold"/>
          <ComboBox x:Name="ThemeCombo" SelectedIndex="0" Style="{StaticResource RoundedComboBoxStyle}">
                        <ComboBoxItem x:Name="ThemeItemDefault" Content="Rendszer (Default)" />
            <ComboBoxItem x:Name="ThemeItemDark" Content="Sötét" />
            <ComboBoxItem x:Name="ThemeItemLight" Content="Világos" />
          
          </ComboBox>
          <TextBlock x:Name="ThemeDefaultHint" Opacity="0.7" Text="Alap: Rendszer" />

          <Button x:Name="BtnApplySettings" Content="Alkalmaz" Click="ApplySettings_Click" Style="{StaticResource AccentButtonStyle}"/>

          <Border Height="1" Margin="0,8,0,8" Background="{ThemeResource DividerStrokeColorDefault}"/>
          <TextBlock x:Name="TxtBackground" Text="Háttérkép (JPG/PNG)"/>
          <Button x:Name="BtnPickBg" Content="Háttér kiválasztása..." Click="PickBackground_Click" Style="{StaticResource AccentButtonStyle}"/>
          <TextBlock x:Name="TxtBgHint" Text="Új háttér azonnal érvényesül; útvonal mentésre kerül."/>

          <Border Height="1" Margin="0,8,0,8" Background="{ThemeResource DividerStrokeColorDefault}"/>
          <TextBlock x:Name="TxtAbout" Text="Névjegy" FontWeight="SemiBold"/>
          <TextBlock x:Name="TxtVersion" Text="Verzió: v2.0" Foreground="{StaticResource MutedTextBrush}" />
          <StackPanel Spacing="4">
            <TextBlock Text="FormatX — © 2025 Hutóczky József (Games Tech). Minden jog fenntartva." TextWrapping="Wrap"/>
            <StackPanel Orientation="Horizontal" Spacing="8">
            <Button x:Name="BtnCheckUpdate" Content="Frissítés" Click="CheckUpdates_Click" Style="{StaticResource AccentButtonStyle}"/>
            <Button x:Name="BtnExportCsv" Content="Napló export (CSV)" Click="ExportCsv_Click" Style="{StaticResource AccentButtonStyle}"/>
          </StackPanel>
          </StackPanel>

          <TextBlock x:Name="TxtFooter" Text=".NET 10 Preview • WinUI 3 • MSIX" Foreground="{StaticResource MutedTextBrush}"/>
        </StackPanel>
        </Border>
      </ui:TabViewItem>
    </ui:TabView>
    </Border>
    
    <!-- Bottom status row -->
    <Border Grid.Row="2" Background="#0F000000" Padding="12" CornerRadius="8" Margin="12">
      <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
        <ProgressBar x:Name="GlobalProgressBar" Width="420" Style="{StaticResource ThinProgressBarStyle}" Minimum="0" Maximum="100"/>
        <TextBlock x:Name="GlobalProgressText" Text="Készenlét" Foreground="{StaticResource MutedTextBrush}" VerticalAlignment="Center"/>
        <TextBlock x:Name="Status" Margin="12,0,0,0" VerticalAlignment="Center" Foreground="{StaticResource MutedTextBrush}"/>
      </StackPanel>
    </Border>

    <!-- Toast overlay -->
    <Border x:Name="ToastOverlay" Grid.Row="1" Grid.Column="1" Visibility="Collapsed" Background="#00000000" IsHitTestVisible="False">
      <StackPanel HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,64,24,0">
        <Border Background="#DD111827" Padding="12" CornerRadius="8">
          <TextBlock x:Name="ToastText" Foreground="White" />
        </Border>
      </StackPanel>
    </Border>
  </Grid>
</Window>